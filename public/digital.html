"<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>

.frame {
  fill: none;
  stroke: #000;
}
.gbar text {
  fill: none;
}
.gbar:hover text {
  fill:#ccc;
}
.temp {
  font: 1em sans-serif;

}
.axis text {
  font: 1.5em sans-serif;
  text-anchor: right;
}


.axis line,
.axis circle {
  fill: none;
  stroke: #777;
  stroke-dasharray: 1,4;
}

.axis :last-of-type circle {
  stroke: #333;
  stroke-dasharray: none;
}

.line {
  fill: none;
  stroke: red;
  stroke-width: 1.5px;
}

.bar {
  /* fill:#333; */
}

.major-axis {
  stroke:#000;
  stroke-width:1.5
}

svg {
  fill: #ccc;
}

</style>
</head>
<body>
  <svg width="1000" height="250">
    <!-- <defs>
      from https://bl.ocks.org/mbostock/10685278
      <path id="segmentA" d="M10,8L14,4L42,4L46,8L42,12L14,12L10,8z"/>
      <path id="segmentF" d="M8,10L12,14L12,42L8,46L4,42L4,14L8,10z"/>
      <path id="segmentB" d="M48,10L52,14L52,42L48,46L44,42L44,14L48,10z"/>
      <path id="segmentG" d="M10,48L14,44L42,44L46,48L42,52L14,52L10,48z"/>
      <path id="segmentE" d="M8,50L12,54L12,82L8,86L4,82L4,54L8,50z"/>
      <path id="segmentC" d="M48,50L52,54L52,82L48,86L44,82L44,54L48,50z"/>
      <path id="segmentD" d="M10,88L14,84L42,84L46,88L42,92L14,92L10,88z"/>
    </defs> -->
  </svg>


<script src="//d3js.org/d3.v4.min.js"></script>
<script>

  //get the svg element
  var svg = d3.select("svg"),
      margin = {top: 20, right: 20, bottom: 30, left: 40},
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom;

  //set the scales
  // var x = d3.scaleTime().range([0, width-margin.left -margin.right])
  var x = d3.scaleBand()
    .range([0, width-margin.left-margin.right])
    .padding(0.2)

  var y = d3.scaleLinear()
    .range([height-margin.top, 0])

  var colors = d3.scaleLinear()
    .domain([0,70,100]) //temps
    .interpolate(d3.interpolateCubehelix)
    .range([d3.hsl(220,1, .5), d3.hsl(220,1,1), d3.hsl(0,1,.5)]);

  //create the parent element
  var g = svg.append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  //set the axes
  var gx = g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")

  var gy = g.append("g")
      .attr("class", "axis axis--y")



  var starting = function(h, w) {
    return [[0,h/4,90],[w/2,0,0],[w,h/4,90],[w/2,h/2,0],[0,3*h/4,90],[w/2,h,0],[w,3*h/4,90]]
  }


  var update = function(time) {
    //time is a string HH:MM

    var str = time.split(":").join("")
    // console.log(str);

    //on/off instructions for each element, per digit
    var digits = [
      [1,1,1,0,1,1,1], //0
      [0,0,1,0,0,0,1], //1
      [0,1,1,1,1,1,0], //2
      [0,1,1,1,0,1,1], //3
      [1,0,1,1,0,0,1], //4
      [1,1,0,1,0,1,1], //5
      [1,1,0,1,1,1,1], //6
      [0,1,1,0,0,0,1], //7
      [1,1,1,1,1,1,1], //8
      [1,1,1,1,0,1,1]  //9
    ]

      //starting positions for digital elements
      var timeDigits= []

      var xy = starting(75, 40)

      for (var i = 0; i<str.length; i++) {
        timeDigits[i]=digits[str.charAt(i)]
      }
      // var drag = d3.drag()
      //     .subject(function(d) { return {x: d[0], y: d[1]}; })
      //     .on("drag", dragged);
      //
      // function dragged(d) {
      //   d[0] = d3.event.x, d[1] = d3.event.y;
      //   // if (this.nextSibling) this.parentNode.appendChild(this);
      //   d3.select(this).attr("transform", "translate(" + d + ")");
      // }

//     function mouseup(d, i) {
// //   if (d3.event.defaultPrevented) return; // dragged
//
//       d3.select(this).transition()
//           .style("fill", "black")
//           .attr("r", 64)
//         .transition()
//           .attr("r", 32)
//           .style("fill", color(i));
//     }

      //** SELECT, ENTER, UPDATE, EXIT **
      //select existing bars, if any
      var allDigits = g.selectAll(".g")
        .data(timeDigits)

      var enterDigits = allDigits.enter().append("g")
        .attr("class","g")
        .attr("transform",function(d,i){return `translate(${i*60} )`})

      var updateDigits = allDigits.merge(enterDigits)

      var select = updateDigits.selectAll(".segment")
        .data(function(d) { return d})

      //new items
      var enter =  select.enter().append("rect")
        .attr("class", "segment")
        .attr("x", function(d,i) {return xy[i][0]-15})
        .attr("y", function(d,i) {return xy[i][1]-2.5})
        .attr("width", 30)
        .attr("height", 5)
        .attr("transform", function(d,i) {return `rotate(${xy[i][2]} ${xy[i][0]} ${xy[i][1]})`})
        // .on("mouseup", mouseup)
        // .call(drag)


      //add the elements, and set static properties
      // enter.append("rect")
      //   .attr("class", "class2")

      //update the existing and new elements
      var update = select.merge(enter)

      //update properties for new and existing items
      update.attr("fill", function(d) { return d ? "cyan" : "#eee"; })

      // update.select(".class2")
      //   .attr("y", function(d) { return y(d.temperatureMax); })
      //   .attr("width", x.bandwidth())
      //   .attr("height", function(d) { return  y(d.temperatureMin)-y(d.temperatureMax) })

      //remove old ones
      var exit = select.exit()
      exit.remove()
    // })
  }

  // update("12:09")

  var step = function(timestamp) {

    var now = new Date()
    var time= now.toTimeString().split(" ")[0]
    update(time)
    window.requestAnimationFrame(step);
}
var animate = window.requestAnimationFrame(step);



</script>
</body>
</html>
